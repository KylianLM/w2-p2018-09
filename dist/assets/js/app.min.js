function getXMLHttpRequest(){var a=null;if(!window.XMLHttpRequest&&!window.ActiveXObject)return alert("Votre navigateur ne supporte pas l'objet XMLHTTPRequest..."),null;if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}else a=new XMLHttpRequest;return a}function init(){StationOverlay.prototype=new google.maps.OverlayView,StationOverlay.prototype.onAdd=function(){var a=document.createElement("div");a.style.position="absolute";var b=document.createElement("img");b.src=this.image_,b.style.width="100%",b.style.height="100%",b.style.position="absolute",a.appendChild(b),this.div_=a;var c=this.getPanes();c.overlayLayer.appendChild(a)},StationOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},StationOverlay.prototype.draw=function(){var a=this.getProjection(),b=a.fromLatLngToDivPixel(this.bounds_.getSouthWest()),c=a.fromLatLngToDivPixel(this.bounds_.getNorthEast()),d=this.div_;d.style.left=b.x+"px",d.style.top=c.y+"px",d.style.width=c.x-b.x+"px",d.style.height=b.y-c.y+"px",this.getPanes().overlayMouseTarget.appendChild(d)},map=new google.maps.Map(document.getElementById("map"),{center:{lat:48.866667,lng:2.333333},zoom:15,disableDefaultUI:!0});var c,a=document.getElementById("inputPos"),b=new google.maps.places.Autocomplete(a);b.addListener("place_changed",function(){c=b.getPlace()}),document.getElementById("validatePos").addEventListener("click",function(a){return a.preventDefault(),c.geometry?(sessionStorage.setItem("latitude",c.geometry.location.lat()),sessionStorage.setItem("longitude",c.geometry.location.lng()),changePosition(c.geometry.location),modalPos.style.display="none",void 0):void window.alert("Autocomplete's returned place contains no geometry")})}function clearOverlays(){for(var a=0;a<markersArray.length;a++)markersArray[a].setMap(null);markersArray.length=0}function getMyPosition(){navigator.geolocation.getCurrentPosition(function(a){sessionStorage.setItem("latitude",a.coords.latitude),sessionStorage.setItem("longitude",a.coords.longitude);var b={lat:parseFloat(sessionStorage.latitude),lng:parseFloat(sessionStorage.longitude)};changePosition(b,b,!0)})}function changePosition(a,b=null,c=true){c&&clearOverlays(),map.panTo(a);var b=new google.maps.Marker({position:b,title:"Vous Ãªtes ici!"});getVelib();var d=new google.maps.LatLngBounds(new google.maps.LatLng(a),new google.maps.LatLng(a.lat+8e-4,a.lng+.001)),e="/assets/img/ico-fill.png";overlay=new StationOverlay(d,e,map)}function getVelib(){var a=getXMLHttpRequest();a.open("GET","https://opendata.paris.fr/api/records/1.0/search/?dataset=stations-velib-disponibilites-en-temps-reel&lang=fr&facet=banking&facet=bonus&facet=status&facet=contract_name&geofilter.distance="+sessionStorage.latitude+"%2C+"+sessionStorage.longitude+"%2C10000",!0),a.send(null),a.onreadystatechange=function(){if(4==a.readyState&&(200==a.status||0==a.status)){var b=JSON.parse(a.responseText),c=["/assets/img/bike.png","/assets/img/nobike.png"];for(item of b.records){var d=new google.maps.Marker({position:{lat:item.geometry.coordinates[1],lng:item.geometry.coordinates[0]},title:""}),e=new google.maps.LatLngBounds(new google.maps.LatLng(item.geometry.coordinates[1],item.geometry.coordinates[0]),new google.maps.LatLng(item.geometry.coordinates[1]+952e-6,item.geometry.coordinates[0]+.001524)),f=c[Math.floor(Math.random()*c.length)];overlay=new StationOverlay(e,f,map),markersArray.push(d)}document.getElementById("modalProx").style.display="block"}}}function StationOverlay(a,b,c){this.bounds_=a,this.image_=b,this.map_=c,this.div_=null,this.setMap(c)}var map,markersArray=[],dataAPI="https://opendata.paris.fr/api/records/1.0/search/?dataset=stations-velib-disponibilites-en-temps-reel&",Login=document.getElementById("login"),modalLogin=document.getElementById("modalLogin"),modalRegister=document.getElementById("modalRegister"),btnRegister=document.getElementById("openModalRegister"),btnLogin=document.getElementById("openModalLogin"),btnConnect=modalLogin.querySelector('input[type="submit"]'),btnSignIn=modalRegister.querySelector('input[type="submit"]'),closeLogin=modalLogin.querySelector(".close"),closeRegister=modalRegister.querySelector(".close");btnLogin.addEventListener("click",function(){modalLogin.style.display="block"}),btnRegister.addEventListener("click",function(){modalRegister.style.display="block"}),closeLogin.addEventListener("click",function(){modalLogin.style.display="none"}),closeRegister.addEventListener("click",function(){modalRegister.style.display="none"}),btnConnect.addEventListener("click",function(a){a.preventDefault(),modalLogin.style.display="none",Login.style.display="none"}),btnSignIn.addEventListener("click",function(a){a.preventDefault(),modalRegister.style.display="none",Login.style.display="none"}),document.getElementById("closeProx").addEventListener("click",function(){document.getElementById("modalProx").style.display="none"}),document.getElementById("closeProx2").addEventListener("click",function(){document.getElementById("modalProx").style.display="none"});var btnMyPos=document.getElementById("myPosition"),btnNewPos=document.getElementById("newPosition"),modalPos=document.getElementById("modalPosition"),closePos=modalPos.querySelector(".close");btnMyPos.addEventListener("click",function(){getMyPosition()}),btnNewPos.addEventListener("click",function(){modalPos.style.display="block",document.getElementById("modalProx").style.display="none"}),closePos.addEventListener("click",function(){modalPos.style.display="none"});var overlay;